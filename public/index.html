<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino Indian Rummy</title>

<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#063d06;
    overflow:hidden;
    color:white;
}

/* Screens */
.screen{display:none;height:100vh;width:100vw}
.active{display:block}

/* Buttons */
input,button{
    padding:10px;
    margin:8px;
    border-radius:8px;
    border:none;
}
button{
    background:#ffd700;
    font-weight:bold;
    cursor:pointer;
}
button:hover{opacity:0.8}

/* Casino Table */
#table{
    position:relative;
    width:100%;
    height:100%;
    background:radial-gradient(circle at center,#0f5c0f,#063d06 70%);
}

/* Oval Table Shape */
#table::before{
    content:"";
    position:absolute;
    top:50%;
    left:50%;
    width:85%;
    height:60%;
    transform:translate(-50%,-50%);
    background:#0c4a0c;
    border-radius:50%;
    box-shadow:0 0 40px black inset;
}

/* Players */
.player{
    position:absolute;
    width:120px;
    padding:6px;
    background:rgba(0,0,0,0.7);
    border-radius:12px;
    text-align:center;
    font-size:12px;
}
.current-turn{
    border:2px solid gold;
}

/* 6 Positions */
.p1{bottom:15px;left:50%;transform:translateX(-50%)}
.p2{top:15px;left:50%;transform:translateX(-50%)}
.p3{left:10px;top:50%;transform:translateY(-50%)}
.p4{right:10px;top:50%;transform:translateY(-50%)}
.p5{top:18%;left:20%}
.p6{top:18%;right:20%}

/* Center Area */
#center{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    text-align:center;
    z-index:10;
}

#discard{
    font-size:28px;
    margin-bottom:10px;
}

/* Player Hand */
#hand{
    position:absolute;
    bottom:0;
    width:100%;
    background:rgba(0,0,0,0.85);
    padding:10px;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    max-height:180px;
    overflow-y:auto;
}

/* Cards */
.card{
    width:45px;
    height:65px;
    background:white;
    border-radius:8px;
    border:2px solid black;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    margin:5px;
    color:black;
    font-weight:bold;
    font-size:14px;
}
.card.red{color:red}
.card.selected{
    border:3px solid gold;
    transform:translateY(-5px);
}

@media(max-width:768px){
    .player{width:100px;font-size:11px}
    .card{width:40px;height:60px}
}
</style>
</head>

<body>

<!-- LOBBY -->
<div id="lobby" class="screen active" style="text-align:center;padding-top:50px">
    <h2>ðŸŽ° Casino Indian Rummy</h2>
    <input id="name" placeholder="Your Name">
    <br>
    <button onclick="createRoom()">Create Room</button>
    <br>
    <input id="roomCode" placeholder="Room Code">
    <button onclick="joinRoom()">Join Room</button>
</div>

<!-- WAITING -->
<div id="waiting" class="screen" style="text-align:center;padding-top:40px">
    <h3>Room: <span id="roomDisplay"></span></h3>
    <div id="waitingPlayers"></div>
    <button onclick="startGame()">Start Game</button>
</div>

<!-- GAME -->
<div id="game" class="screen">
<div id="table">

<div id="playersArea"></div>

<div id="center">
    <div id="discard"></div>
    <button onclick="drawCard('deck')">Draw Deck</button>
    <button onclick="drawCard('discard')">Draw Discard</button>
    <button onclick="discardSelected()">Discard</button>
</div>

<div id="hand"></div>

</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>

const socket = io();
let currentRoom=null;
let gameState=null;
let selected=[];

/* Screen Switch */
function show(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

/* Room */
function createRoom(){
    const name=document.getElementById("name").value;
    socket.emit("createRoom",{playerName:name});
}

function joinRoom(){
    const name=document.getElementById("name").value;
    const code=document.getElementById("roomCode").value;
    socket.emit("joinRoom",{playerName:name,roomCode:code});
}

function startGame(){
    socket.emit("startGame",{roomCode:currentRoom});
}

/* Game Actions */
function drawCard(source){
    socket.emit("drawCard",{roomCode:currentRoom,source});
}

function discardSelected(){
    if(selected.length!==1){
        alert("Select 1 card");
        return;
    }
    socket.emit("discardCard",{
        roomCode:currentRoom,
        cardId:selected[0]
    });
    selected=[];
}

/* Render */
function render(){
    if(!gameState) return;

    const area=document.getElementById("playersArea");
    area.innerHTML="";

    gameState.players.forEach((p,i)=>{
        const div=document.createElement("div");
        div.className="player p"+(i+1);
        if(p.id===gameState.currentTurn)
            div.classList.add("current-turn");

        div.innerHTML=`
            <div>${p.name}</div>
            <div>Cards: ${p.cardCount}</div>
            <div>Score: ${p.totalScore}</div>
        `;
        area.appendChild(div);
    });

    const discard=document.getElementById("discard");
    discard.innerHTML="";
    const top=gameState.discardPile.slice(-1)[0];
    if(top){
        discard.innerHTML=`${top.value} ${top.suit}`;
    }

    const hand=document.getElementById("hand");
    hand.innerHTML="";
    gameState.hand.forEach(card=>{
        const div=document.createElement("div");
        div.className="card";
        if(card.suit==="â™¥"||card.suit==="â™¦")
            div.classList.add("red");
        if(selected.includes(card.id))
            div.classList.add("selected");

        div.innerHTML=`${card.value}<br>${card.suit}`;

        div.onclick=()=>{
            if(selected.includes(card.id))
                selected=selected.filter(id=>id!==card.id);
            else
                selected.push(card.id);
            render();
        };

        hand.appendChild(div);
    });
}

/* Socket Events */

socket.on("roomCreated",data=>{
    currentRoom=data.roomCode;
    document.getElementById("roomDisplay").innerText=currentRoom;
    show("waiting");
});

socket.on("roomJoined",data=>{
    currentRoom=data.roomCode;
    show("waiting");
});

socket.on("roomUpdate",room=>{
    const div=document.getElementById("waitingPlayers");
    div.innerHTML="";
    room.players.forEach(p=>{
        div.innerHTML+=`<div>${p.name}</div>`;
    });
});

socket.on("gameState",state=>{
    gameState=state;
    show("game");
    render();
});

socket.on("error",msg=>alert(msg));

</script>

</body>
</html>
